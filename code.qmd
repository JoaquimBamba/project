---
title: "quarto"
author: "Amandine & Joaquim"
format: html
echo: false
message: false
editor: visual
---

# Data management project :

Joaquim Bamba & Amandine Godefroy

## Links and sources

[Link github repository](https://github.com/JoaquimBamba/project)

*Links to the sources :*

[CO2 emission](https://data.jrc.ec.europa.eu/dataset/377801af-b094-4943-8fdc-f79a7c0c2d19#dataaccess)

[Energy consumption](https://www.cia.gov/the-world-factbook/field/energy-consumption-per-capita/country-comparison/)

[GDP growth](https://data.worldbank.org/indicator/NY.GDP.MKTP.KD.ZG)

[GDP](https://data.worldbank.org/indicator/NY.GDP.MKTP.CD)

[GDP per capita](https://data.worldbank.org/indicator/NY.GDP.PCAP.CD)

[GDP composition by sector of origin](https://wdi.worldbank.org/table/4.2)

[Gross capital formation](https://data.worldbank.org/indicator/NE.GDI.TOTL.ZS?view=chart)

[Population growth](https://data.worldbank.org/indicator/SP.POP.GROW?view=chart)

[Urban population](https://data.worldbank.org/indicator/SP.URB.TOTL.IN.ZS?view=chart)

[Industrial production growth](https://data.worldbank.org/indicator/SP.URB.TOTL.IN.ZS?view=chart)

[Renewable energy consumption](https://data.worldbank.org/indicator/EG.FEC.RNEW.ZS)

*Sources* *:*

-   **European Commission, JRC Data Catalogue :** The main website of the European Comission's joint research center. The JRC provides independant and evidence-based science and knowledge supporting the EU policies.

-   **gov :** The CIA's "World Factbook" is a comprehensive and publicly available online resource that provides information about countries around the world. Created and maintained by the United States Central Intelligence Agency (CIA), this publication offers a detailed overview of various aspects of nations, including their geography, population, government, economy, infrastructure, history, and much more. The World Factbook is regularly updated to reflect demographic, political, economic, and other changes in countries worldwide. It's used by numerous individuals, including researchers, students, journalists, and professionals, as a reliable reference for obtaining accurate data about countries.

-   **World Bank Open Data :** The World Bank Open Data is an initiative by the World Bank Group that provides free and open access to a wide range of global development data. It offers a vast collection of data on various aspects of development across countries, including social, economic, financial, and environmental indicators. This data is made available to the public, researchers, policymakers, and developers to promote transparency, informed decision-making, and development efforts worldwide. The World Bank Open Data platform allows users to access, download, and visualize data in various formats, including charts, graphs, and maps. It serves as a valuable resource for researchers, policymakers, journalists, and anyone interested in understanding global development trends and making data-driven decisions to support development initiatives worldwide.

## Data importation

```{r}
#| echo: false
#| warning: false
#| message: false

library(here)
library(ggplot2)
library(tidyr)
library(dplyr)
library(gridExtra)
here::i_am("project.Rproj")
```

```{r}

#| echo: false
#| warning: false

GDP <- read.csv2(here("data/GDP.csv"))

gdp_per_capita <- read.csv2("data/GDP_per_capita.csv")

gdp_growth <- read.csv2(here("data/GDP_growth.csv"))

gdp_by_sector <- read.csv2(here("data/Structure_of_value_added.csv"))

energy_consumption <- vroom::vroom(here("data/Energy_consumption.csv"),show_col_types = FALSE)

gross_capital <- read.csv2(here("data/Gross_capital_formation.csv"))

population_growth <- read.csv2(here("data/POP_growth.csv"))

urban_population <- read.csv2(here("data/Urban_population.csv"))

co2<- vroom::vroom(here("data/CO2.csv"), show_col_types = FALSE)

fossil_CO2_by_sector_and_country <- vroom::vroom(here("data/CO2/fossil_CO2_by_sector_and_country.csv"),delim = ";", show_col_types = FALSE)

fossil_CO2_per_GDP_by_country <- vroom::vroom(here("data/CO2/fossil_CO2_per_GDP_by_country.csv"), delim = ";",show_col_types = FALSE)

C02_macro_regions <- vroom::vroom(here("data/CO2/LULUCF by macro regions.csv"),delim = ";", show_col_types = FALSE)

fossil_CO2_totals_by_country <- vroom::vroom(here("data/CO2/fossil_CO2_totals_by_country.csv"),delim = ";", show_col_types = FALSE)

coal_revenu <- vroom::vroom(here("data/coal_revenu.csv"),show_col_types = FALSE)

industrial_production_growth <- vroom::vroom(here("data/industrial_production_growth.csv"), show_col_types = FALSE)

renewable_energy_consumption <- vroom::vroom(here("data/Renewable_energy_consumption.csv"), show_col_types = FALSE)
```

## Creation of the economic growth database

### Variables description

Gross capital formation (in percentage of GDP) : consists of outlays on additions to the fixed assets of the economy plus net changes in the level of inventories.

Annual percentage growth rate of GDP : at market prices based on constant local currency. Aggregates are based on constant 2015 prices, expressed in U.S. dollars.

GDP at purchaser's prices (current US\$) : the sum of gross value added by all resident producers in the economy plus any product taxes and minus any subsidies not included in the value of the products.

Gdp per capita : the gdp (in current US\$) divided by midyear population.

The structure of value added : the percentage of GDP coming from Agriculture, Industry, Manufacturing and Services.

Annual population growth rate for year t : the exponential rate of growth of midyear population from year t-1 to t, expressed as a percentage .

Urban population (in percentage of the total population) : refers to people living in urban areas as defined by national statistical offices.

### Cleaning the data sets

#### cleaning of gross_capital

```{r}
# We erase the unnecessary columns
gross_capital <- gross_capital |>  select(-Indicator.Name, -Indicator.Code, -Country.Code)

#because all the years start with an 'X' we must suppress the 'X' at the start

# we create a variable with all the columns that starts with an "X"
colonnes_a_modifier <- colnames(gross_capital)[startsWith(colnames(gross_capital), "X")]

# We suppress all the "X"
colnames(gross_capital)[startsWith(colnames(gross_capital), "X")] <- sub("^X", "", colonnes_a_modifier)

gross_capital <- gross_capital %>% pivot_longer(cols = c("1960","1961","1962", "1963", "1964", "1965", "1966", "1967", "1968", "1969", "1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"), names_to = "year", values_to = "gross_capital")

# We rename the first column
gross_capital <- gross_capital %>%
  rename(country = Country.Name)

# We put NA instead of blanks
gross_capital <- gross_capital %>% mutate_all(~na_if(., ""))

# Then we re-iterate the process for each variable.
```

#### cleaning of gdp_growth

```{r}
gdp_growth <- gdp_growth |>  select(-Indicator.Name, -Indicator.Code, -Country.Code)

colonnes_a_modifier <- colnames(gdp_growth)[startsWith(colnames(gdp_growth), "X")]

colnames(gdp_growth)[startsWith(colnames(gdp_growth), "X")] <- sub("^X", "", colonnes_a_modifier)

gdp_growth <- gdp_growth %>% pivot_longer(cols = c("1960","1961","1962", "1963", "1964", "1965", "1966", "1967", "1968", "1969", "1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"), names_to = "year", values_to = "gdp_growth")

gdp_growth <- gdp_growth %>%
  rename(country = Country.Name)

gdp_growth[gdp_growth == ''] <- NA
```

#### cleaning of GDP

```{r}
GDP <- GDP |>  select(-Indicator.Name, -Indicator.Code, -Country.Code)

colonnes_a_modifier <- colnames(GDP)[startsWith(colnames(GDP), "X")]

colnames(GDP)[startsWith(colnames(GDP), "X")] <- sub("^X", "", colonnes_a_modifier)

GDP <- GDP %>% pivot_longer(cols = c("1960","1961","1962", "1963", "1964", "1965", "1966", "1967", "1968", "1969", "1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"), names_to = "year", values_to = "GDP")

GDP <- GDP %>%
  rename(country = Country.Name)

GDP <- GDP %>% mutate_all(~na_if(., ""))
```

#### cleaning og gdp_per_capita

```{r}
gdp_per_capita <- gdp_per_capita |>  select(-Indicator.Name, -Indicator.Code, -Country.Code)

colonnes_a_modifier <- colnames(gdp_per_capita)[startsWith(colnames(gdp_per_capita), "X")]

colnames(gdp_per_capita)[startsWith(colnames(gdp_per_capita), "X")] <- sub("^X", "", colonnes_a_modifier)

gdp_per_capita <- gdp_per_capita %>% pivot_longer(cols = c("1960","1961","1962", "1963", "1964", "1965", "1966", "1967", "1968", "1969", "1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"), names_to = "year", values_to = "gdp_per_capita")

gdp_per_capita <- gdp_per_capita %>%
  rename(country = Country.Name)

gdp_per_capita <- gdp_per_capita %>% mutate_all(~na_if(., ""))
```


#### cleaning of gdp_by_sector

```{r}
gdp_by_sector <- gdp_by_sector |> select(-Gross.domestic.product, -X.1) |>
  rename(gdp.agriculture.2010 = Agriculture,
         gdp.agriculture.2020 = X.2,
         gdp.industry.2010 = Industry,
         gdp.industry.2020 = X.3,
         gdp.manufacturing.2010 = Manufacturing,
         gdp.manufacturing.2020 = X.4,
         gdp.services.2010 = Services,
         gdp.services.2020= X.5,
         country = X)

# We suppress the unnecessary rows
gdp_by_sector <- gdp_by_sector[-1,]
gdp_by_sector <- gdp_by_sector[-1,]

gdp_by_sector <- gdp_by_sector %>% mutate_all(~na_if(., ".."))
```

#### cleaning of population_growth

```{r}
population_growth <- population_growth |>  select(-Indicator.Name, -Indicator.Code, -Country.Code)

colonnes_a_modifier <- colnames(population_growth)[startsWith(colnames(population_growth), "X")]

colnames(population_growth)[startsWith(colnames(population_growth), "X")] <- sub("^X", "", colonnes_a_modifier)

population_growth <- population_growth %>% pivot_longer(cols = c("1960","1961","1962", "1963", "1964", "1965", "1966", "1967", "1968", "1969", "1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"), names_to = "year", values_to = "population_growth")

population_growth <- population_growth %>%
  rename(country = Country.Name)

population_growth[population_growth == ''] <- NA
```

#### cleaning of urban_population

```{r}
urban_population <- urban_population |>  select(-Indicator.Name, -Indicator.Code, -Country.Code)

colonnes_a_modifier <- colnames(urban_population)[startsWith(colnames(urban_population), "X")]

colnames(urban_population)[startsWith(colnames(urban_population), "X")] <- sub("^X", "", colonnes_a_modifier)

urban_population <- urban_population %>% pivot_longer(cols = c("1960","1961","1962", "1963", "1964", "1965", "1966", "1967", "1968", "1969", "1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"), names_to = "year", values_to = "urban_population")

urban_population <- urban_population %>%
  rename(country = Country.Name)

urban_population <- urban_population %>% mutate_all(~na_if(., ""))
```

### Basic information on the data files

#### GDP

```{r}
table_gdp <- GDP |>
  summarise(
            "Nb of rows" =nrow(GDP),
            "Nb of columns" = ncol(GDP),
            "Mean" = mean(as.numeric(GDP), na.rm = TRUE),
            "Median" = median(GDP, na.rm = TRUE),
            "Min" = min(GDP, na.rm = TRUE),
            "Max" = max(GDP, na.rm = TRUE)
            )
knitr::kable(table_gdp)
```

#### gdp_per_capita
```{r}
table_gdp_per_capita <- gdp_per_capita |>
  summarise(
            "Nb of rows" =nrow(gdp_per_capita),
            "Nb of columns" = ncol(gdp_per_capita),
            "Mean" = mean(as.numeric(gdp_per_capita), na.rm = TRUE),
            "Median" = median(as.numeric(gdp_per_capita), na.rm = TRUE),
            "Min" = min(gdp_per_capita, na.rm = TRUE),
            "Max" = max(gdp_per_capita, na.rm = TRUE)
            )
knitr::kable(table_gdp_per_capita)
```

#### gdp_growth

```{r}
table_gdp_growth <- gdp_growth|>
  summarise(
            "Nb of rows"=nrow(gdp_growth),
            "Nb of columns"=ncol(gdp_growth),
            "Mean" = mean(as.numeric(gdp_growth), na.rm = TRUE),
            "Median" = median(as.numeric(gdp_growth), na.rm = TRUE),
            "Min" = min(gdp_growth, na.rm = TRUE),
            "Max" = max(gdp_growth, na.rm = TRUE)
            )
knitr::kable(table_gdp_growth)
```

#### gross_capital

```{r}
table_gross_capital <- gross_capital|>
  summarise(
            "Nb of rows"=nrow(gross_capital),
            "Nb of columns"=ncol(gross_capital),
            "Mean" = mean(as.numeric(gross_capital), na.rm = TRUE),
            "Median" = median(gross_capital, na.rm = TRUE),
            "Min" = min(gross_capital, na.rm = TRUE),
            "Max" = max(gross_capital, na.rm = TRUE)
            )
knitr::kable(table_gross_capital)
```

#### gdp_by_sector

```{r}
table_gdp_by_sector <- gdp_by_sector |>
  summarise(
    "Nb of rows" = nrow(gdp_by_sector),
    "Nb of columns" = ncol(gdp_by_sector),
    "Mean.services" = mean(as.numeric(gdp.services.2020), na.rm = TRUE),
    "Median.services" = median(as.numeric(gdp.services.2020), na.rm = TRUE),
    "Mean.manufacturing" = mean(as.numeric(gdp.manufacturing.2020), na.rm = TRUE),
    "Median.manufacturing" = median(as.numeric(gdp.manufacturing.2020), na.rm = TRUE),
    "Mean.industry" = mean(as.numeric(gdp.industry.2020), na.rm = TRUE),
    "Median.industry" = median(as.numeric(gdp.industry.2020), na.rm = TRUE),
    "Mean.agriculture" = mean(as.numeric(gdp.agriculture.2020, na.rm = TRUE),
    "Median.agriculture" = median(as.numeric(gdp.agriculture.2020), na.rm = TRUE)))

knitr::kable(table_gdp_by_sector)
```

#### population_growth

```{r}
table_population_growth <- population_growth |>
  summarise(
    "Nb of rows" = nrow(population_growth),
    "Nb of columns" = ncol(population_growth),
    "Mean" = mean(as.numeric(population_growth), na.rm = TRUE),
    "Median" = median(population_growth, na.rm = TRUE),
    "Min" = min(population_growth, na.rm = TRUE),
    "Max" = max(population_growth, na.rm = TRUE)
  )
knitr::kable(table_population_growth)
```

#### urban_population

```{r}
table_urban_population <- urban_population |>
  summarise(
    "Nb of rows" = nrow(urban_population),
    "Nb of columns" = ncol(urban_population),
    "Mean" = mean(as.numeric(urban_population), na.rm = TRUE),
    "Median" = median(urban_population, na.rm = TRUE),
    "Min" = min(urban_population, na.rm = TRUE),
    "Max" = max(urban_population, na.rm = TRUE)
  )
knitr::kable(table_urban_population)
```

### Data joining

We need to create a data base with all the economic growth relative variables.

```{r}
# In order to do so we join each of the data base two by two
gdp_gdp_growth <- inner_join(GDP, gdp_growth, by=c("country","year"))

all_gdp <- inner_join(gdp_gdp_growth, gdp_per_capita, by=c("country","year"))

all_gdp_gross_capital <- inner_join(all_gdp, gross_capital, by=c("country","year"))

pop_growth_urban_pop <- inner_join(population_growth, urban_population, by=c("country","year"))

# Final economic growth data base
economic_growth_dataset <- inner_join(all_gdp_gross_capital, pop_growth_urban_pop, by=c("country","year"))
```

## Creation of the energy database

### Variables description

CO2 emissions : Carbon dioxide emissions from consumption of energy is the total amount of carbon dioxide, measured in metric tons, released by burning fossil fuels in the process of producing and consuming energy. This is usually the main variable used to measure how polluting a country is. We will use four different datasets showing the CO2 emissions by sector and country, per capita per country, totals per country, and totals by macro regions.

Energy consumption per capita : measures the total amount of consumed energy divided by a country's population, reported in Btu per person. Linking energy consumption per capita to pollution is vital as higher consumption often translates to increased emissions from energy sources like fossil fuels, contributing significantly to air and greenhouse gas pollution.

Coal revenu : revenu from coal extraction and use as % of the GDP. Coal has a significant environmental impact as a high emitter of pollutants like sulfur dioxide and carbon dioxide when burned for energy.

Industrial_production_growth : annual percentage increase in industrial production (includes manufacturing, mining, and construction). The expansion of industrial activities often leads to increased emissions of pollutants, including greenhouse gases and particulate matter, directly impacting air, water, and soil quality.

Renewable energy consumption : Renewable energy consumption is the share of renewable energy in total final energy consumption. We expect this percentage to be higher in developed countries.

### Cleaning the data sets

Let's create a first dataset containing the informative variables for the year 2019 only.

```{r}
# We keep only the relevant columns
co2 <- select(co2, value, name)

energy_consumption <- select(energy_consumption, value, name)

coal_revenu <- select(coal_revenu, value, name)

industrial_production_growth <- select(industrial_production_growth, value, name)

renewable_energy_consumption <- select(renewable_energy_consumption, `Country Name`, `2019`)

# We rename them
colnames(co2) <- c("co2.emissions", "country")
colnames(energy_consumption) <- c("energy.consumption", "country")
colnames(coal_revenu) <- c("coal.revenu", "country")
colnames(industrial_production_growth) <- c("industrial.production.growth", "country")
colnames(renewable_energy_consumption) <- c("country", "renewable.energy.consumption")
```

### Basic information on the data files

#### co2 2019

```{r}
table_co2 <- co2 |>
  summarise(
    "Nb of rows" = nrow(co2),
    "Nb of columns" = ncol(co2),
    "Mean" = mean(co2.emissions, na.rm = TRUE),
    "Median" = median(co2.emissions, na.rm = TRUE),
    "Min" = min(co2.emissions, na.rm = TRUE),
    "Max" = max(co2.emissions, na.rm = TRUE)
  )
knitr::kable(table_co2)
```

#### energy_consumption

```{r}
table_energy_consumption <- energy_consumption |>
  summarise(
    "Nb of rows" = nrow(energy_consumption),
    "Nb of columns" = ncol(energy_consumption),
    "Mean" = mean(energy.consumption, na.rm = TRUE),
    "Median" = median(energy.consumption, na.rm = TRUE),
    "Min" = min(energy.consumption, na.rm = TRUE),
    "Max" = max(energy.consumption, na.rm = TRUE)
  )
knitr::kable(table_energy_consumption)
```

#### coal_revenu

```{r}
table_coal_revenu <- coal_revenu |>
  summarise(
    "Nb of rows" = nrow(coal_revenu),
    "Nb of columns" = ncol(coal_revenu),
    "Mean" = mean(coal.revenu, na.rm = TRUE),
    "Median" = median(coal.revenu, na.rm = TRUE),
    "Min" = min(coal.revenu, na.rm = TRUE),
    "Max" = max(coal.revenu, na.rm = TRUE)
  )
knitr::kable(table_coal_revenu)
```

#### industrial_production_growth

```{r}
table_industrial_production_growth <- industrial_production_growth |>
  summarise(
    "Nb of rows" = nrow(industrial_production_growth),
    "Nb of columns" = ncol(industrial_production_growth),
    "Mean" = mean(industrial.production.growth, na.rm = TRUE),
    "Median" = median(industrial.production.growth, na.rm = TRUE),
    "Min" = min(industrial.production.growth, na.rm = TRUE),
    "Max" = max(industrial.production.growth, na.rm = TRUE)
  )
knitr::kable(table_industrial_production_growth)
```

#### renewable_energy_consumption

```{r}
table_renewable_energy_consumption <- renewable_energy_consumption |>
  summarise(
    "Nb of rows" = nrow(renewable_energy_consumption),
    "Nb of columns" = ncol(renewable_energy_consumption),
    "Mean" = mean(renewable.energy.consumption, na.rm = TRUE),
    "Median" = median(renewable.energy.consumption, na.rm = TRUE),
    "Min" = min(renewable.energy.consumption, na.rm = TRUE),
    "Max" = max(renewable.energy.consumption, na.rm = TRUE)
  )
knitr::kable(table_renewable_energy_consumption)
```
#### CO2 by country 

Let's use the CO2 data given year by year.

```{r}
#We get ride of the useless columns
fossil_CO2_totals_by_country <-fossil_CO2_totals_by_country[,c(-1,-2)]

fossil_CO2_totals_by_country <- fossil_CO2_totals_by_country %>% pivot_longer(cols = c("1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021"), names_to = "year", values_to = "CO2_by_country")

fossil_CO2_totals_by_country <- fossil_CO2_totals_by_country %>%
  rename(country = Country)
```

#### CO2 by GDP by country

Let's use the CO2 data given year by year.

```{r}
#We get ride of the useless columns
fossil_CO2_per_GDP_by_country <-fossil_CO2_per_GDP_by_country[,c(-1,-2)]

```

```{r}
fossil_CO2_per_GDP_by_country <- fossil_CO2_per_GDP_by_country %>% pivot_longer(cols = c("1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021"), names_to = "year", values_to = "CO2_per_GDP_by_country")

fossil_CO2_per_GDP_by_country <- fossil_CO2_per_GDP_by_country %>%
  rename(country = Country)
```

#### CO2 by sector by country 

```{r}
#We get ride of the useless columns
fossil_CO2_by_sector_and_country <-fossil_CO2_by_sector_and_country[,c(-1,-2)]

```

```{r}
fossil_CO2_by_sector_and_country <- fossil_CO2_by_sector_and_country %>% pivot_longer(cols = c("1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021"), names_to = "year", values_to = "CO2_by_sector_country")

fossil_CO2_by_sector_and_country <- fossil_CO2_by_sector_and_country %>%
  rename(country = Country)

```

#### Data joining

```{r}
# In order to do so we join each of the data base two by two
CO2_totals_GDP <- inner_join(fossil_CO2_totals_by_country, fossil_CO2_per_GDP_by_country, by=c("country","year"))

CO2_totals_GDP_sector <- inner_join(CO2_totals_GDP, fossil_CO2_by_sector_and_country, by=c("country","year"))

```

The dataset energie_cO2_tatals_country contains the information relative to the energy and the CO2 emmissions for each country from 1970 to 2020.

Data joining CO2 2019 :

```{r}
# we merge the data sets by country name
temp_merged <- merge(co2, energy_consumption, by = "country", all = FALSE)
temp_merged <- merge(temp_merged, industrial_production_growth, by = "country", all = FALSE)
temp_merged <- merge(temp_merged, coal_revenu, by = "country", all = FALSE)
# we merge the temporary data set obtained with the last one with name again
energy_dataset2019 <- merge(temp_merged, renewable_energy_consumption, by = "country", all = FALSE)

```

We create a dataset containing the information concerning the year 2019. We will use it order to have an overview of the situation using relatively recent data given in instantaneous section.

## Final Data set

```{r}
growth_CO2 <- inner_join(CO2_totals_GDP_sector, economic_growth_dataset, by=c("country","year"))
```



for 2019 : 

```{r}
# We merge our economic growth dataset and our energy dataset 

dataset <- inner_join(economic_growth_dataset, energy_dataset2019, by=join_by(country))
```

## Research question

The Kuznets curve, originating from Simon Kuznets' research on economic growth during the 1950s, illustrates a U-shaped correlation between a nation's developmental stage and income inequality. In 1991, Grossman and Krueger expanded this concept to environmental considerations. However, it wasn't until Panayotou's 1993 article that the Environmental Kuznets Curve (EKC) was formally introduced.

The EKC proposes that in the early phases of economic progress, there is minimal concern for environmental issues. As income levels rise sufficiently to meet essential needs, a pivotal threshold (known as the turning point) is reached, prompting heightened environmental awareness and a reversal in trends. Beyond this threshold, economic advancement aligns with enhanced environmental conditions, specifically a decline in pollution. Thus, it suggests an inverse U-shaped association between pollution and economic development.


We will try to see if a country CO2 emission are effectively explained by its economic and industrial development.


## Graphical representation 

### Top 5 world economies

We will make a graphical representation of our target variable : CO2 emissions.

```{r}
# Third countries with the highest CO2 emissions ?
top_countries <- dataset[order(-dataset$co2.emissions), ][1:3, ]


# Creation of the graph with the points of the most polluters
ggplot(data = dataset, aes(x = country, y = co2.emissions)) +
  geom_blank() +  # Suppression of the points to mask the name of the other countries on the x axis
  geom_text(data = top_countries, aes(label = country), size = 3, angle = 45, vjust = -0.5, hjust = 1) +  # Display of the names of the greatest polluters
  geom_point(data = top_countries, size = 3) +  # Points for the three greatest polluters
  labs(x = NULL, y = "Émissions de CO2 en 2019") +  # Suppression of the x axis label 
  ggtitle("Dispersions des émissions de CO2 par pays en 2019")

```

We can spot that CO2 emissions are very unequally distributed. China, India and the US are by far more polluting.






Now lets plot the CO2 emissions per country depending on their GDP.

```{r}
growth_CO2_50_first<-growth_CO2|>group_by(country)

growth_CO2_50_first<-growth_CO2_50_first[4929:4960,]

ggplot(growth_CO2_50_first, aes(x =GDP, y =CO2_by_country )) +
  geom_point(na.rm=T)+
  labs(title = "Croissance du CO2 par rapport au PIB (US 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

  
```

```{r}
growth_CO2_coutry<-growth_CO2|>select(contains("China"))

growth_CO2_50_first<-growth_CO2[2433:2464,]

ggplot(growth_CO2_50_first, aes(x =GDP, y =CO2_by_country )) +
  geom_point(na.rm=T)+
  labs(title = "Croissance du CO2 par rapport au PIB (Japan 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

  
```
```{r}

growth_CO2_50_first<-growth_CO2[2433:2464,]

ggplot(growth_CO2_50_first, aes(x =GDP, y =CO2_by_country )) +
  geom_point(na.rm=T)+
  labs(title = "Croissance du CO2 par rapport au PIB (Japan 1970-2021)") +
  theme_minimal()

  
```


```{r}

growth_CO2_50_first<-subset(growth_CO2, country == "Germany")

ggplot(growth_CO2_50_first, aes(x =GDP, y =CO2_by_country )) +
  geom_point(na.rm=T)+
  labs(title = "Croissance du CO2 par rapport au PIB (Germany 1970-2021)") +
  theme_minimal()

  
```

```{r}

growth_CO2_50_first<-subset(growth_CO2, country == "United Kingdom")

ggplot(growth_CO2_50_first, aes(x =GDP, y =CO2_by_country )) +
  geom_point(na.rm=T)+
  labs(title = "Croissance du CO2 par rapport au PIB (Germany 1970-2021)") +
  theme_minimal()

  
```


By plotting the CO2 emissions of top 5 world economies, we spot that the relation is clearly verified in China. In the United Kingdom and in Germany, we observe negative relation between the CO2 emissions and the GPD over time. However, it is important to mention that the UK and Germany were already considered as developped economies before 1970. It could explain the graphs showing the decreasing part of the reverse U relationship. 

### Western and Eastern European countries

```{r}
western_european_countries <- c("Germany", "Austria", "Belgium", "France", "Ireland", "Luxembourg", "Netherlands", "United Kingdom", "Switzerland", "Liechtenstein", "Monaco","Sweden")

# Filter data for Western European countries
growth_CO2_western_european_countries <- subset(growth_CO2, country %in% western_european_countries)

# Use ggplot with different color for each country
ggplot(growth_CO2_western_european_countries, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Western Europe 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

```
By plotting the Western European coutries only, we can clearly spot reverse U relationship for Belgium and the Netherlands however, the data of Sweden, Luxembourg are following the former intuition we had about Germany and the United Kingdom we a purely negative relationship (second part of the reverse U).

To confirm the intuition, let's plot the Eastern Europe countries data considering that they developped later than Eastern ones


```{r}
eastern_european_countries1 <- c("Estonia", "Hungary", "Kosovo", "Latvia", "Lithuania","Moldova", "Montenegro", "North Macedonia", "Poland", "Romani
")

eastern_european_countries2<- c("Albania", "Belarus", "Bosnia and Herzegovina", "Bulgaria", "Croatia", "Czech Republic")

# Filter data for Western European countries
growth_CO2_eastern_european_countries1 <- subset(growth_CO2, country %in% eastern_european_countries1)

# Use ggplot with different color for each country
plot1<-ggplot(growth_CO2_eastern_european_countries1, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Western Europe 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

growth_CO2_eastern_european_countries2 <- subset(growth_CO2, country %in% eastern_european_countries2)

# Use ggplot with different color for each country
plot2<-ggplot(growth_CO2_eastern_european_countries2, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Western Europe 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())



grid.arrange(plot1, plot2, nrow = 2)

```
Indeed, the expected reverse U relationship is clearer for Easter European coutries than for the Western ones.

### Subsaharan African Countries


```{r}
SA_countries1 <- c("Angola", "Benin", "Botswana", "Burkina Faso", "Burundi", "Cabo Verde", "Cameroon", "Central African Republic", "Chad", "Comoros", "Democratic Republic of the Congo")

SA_countries2 <- c("Djibouti", "Equatorial Guinea", "Eritrea", "Eswatini", "Ethiopia", "Gabon", "The Gambia", "Ghana", "Guinea", "Guinea-Bissau", "Ivory Coast", "Kenya", "Lesotho")

SA_countries3 <- c("Liberia", "Madagascar", "Malawi", "Mali", "Mauritania", "Mauritius", "Mozambique", "Namibia", "Niger", "Nigeria", "Republic of the Congo", "Rwanda", "Sao Tome and Principe")

SA_countries4 <- c("Senegal", "Seychelles", "Sierra Leone", "Somalia", "South Africa", "South Sudan", "Sudan", "Tanzania", "Togo", "Uganda", "Zambia", "Zimbabwe")


# Filter data for Western European countries
growth_CO2_SA_countries1 <- subset(growth_CO2, country %in% SA_countries1)

# Use ggplot with different color for each country
plot1<-ggplot(growth_CO2_SA_countries1, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Western Europe 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

growth_CO2_SA_countries2 <- subset(growth_CO2, country %in% SA_countries2)

# Use ggplot with different color for each country
plot2<-ggplot(growth_CO2_SA_countries2, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Western Europe 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

growth_CO2_SA_countries3 <- subset(growth_CO2, country %in% SA_countries3)

# Use ggplot with different color for each country
plot3<-ggplot(growth_CO2_SA_countries3, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Western Europe 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

growth_CO2_SA_countries4 <- subset(growth_CO2, country %in% SA_countries4)

# Use ggplot with different color for each country
plot4<-ggplot(growth_CO2_SA_countries4, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Western Europe 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

grid.arrange(plot1, plot2, nrow = 2)
grid.arrange(plot3, plot4, nrow = 2)
```

When we pay attention to the Subsaaran Afrincan coutries that are still developping the relation relation between CO2 emissions and GDP seems to be positive considering that these country are still on the first part of reverse U relationship between these two variables.

## Statistical tests : 

```{r}
options(digits=5)
SA_countries <-c("Angola", "Benin", "Botswana", "Burkina Faso", "Burundi", "Cabo Verde", "Cameroon", "Central African Republic", "Chad", "Comoros", "Democratic Republic of the Congo", "Djibouti", "Equatorial Guinea", "Eritrea", "Eswatini", "Ethiopia", "Gabon", "The Gambia", "Ghana", "Guinea", "Guinea-Bissau", "Ivory Coast", "Kenya", "Lesotho", "Liberia", "Madagascar", "Malawi", "Mali", "Mauritania", "Mauritius", "Mozambique", "Namibia", "Niger", "Nigeria", "Republic of the Congo", "Rwanda", "Sao Tome and Principe", "Senegal", "Seychelles", "Sierra Leone", "Somalia", "South Africa", "South Sudan", "Sudan", "Tanzania", "Togo", "Uganda", "Zambia", "Zimbabwe"
)
growth_CO2_SA_countries <- subset(growth_CO2, country %in% SA_countries)|>select(CO2_by_country, GDP)

#delete the lines with NA
growth_CO2_SA_countries <- growth_CO2_SA_countries[complete.cases(growth_CO2_SA_countries), ]

# Convertir les valeurs de la colonne 'CO2_by_country' en numériques
growth_CO2_SA_countries$CO2_by_country <- as.numeric(as.character(growth_CO2_SA_countries$CO2_by_country))

# Convertir les valeurs de la colonne 'GDP' en numériques
growth_CO2_SA_countries$GDP <- as.numeric(as.character(growth_CO2_SA_countries$GDP))


SA_CO2<-growth_CO2_SA_countries|>pull(CO2_by_country)
SA_GDP<-growth_CO2_SA_countries|>pull(GDP)


```

```{r}

for (i in 1:length(growth_CO2_SA_countries)){
  for (j in 1:length(growth_CO2_SA_countries)){
    growth_CO2_SA_countries[i,j]<-round(growth_CO2_SA_countries[i,j], digits=4)
  }
}

```

