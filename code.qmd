---
title: "quarto"
author: "Amandine & Joaquim"
format: html
echo: false
message: false
editor: visual
---

```{=html}
<style>
  body {
    text-align: justify}
</style>
```
```{r}
#| echo: false
#| warning: false
#| message: false

library(here)
library(ggplot2)
library(tidyr)
library(dplyr)
library(gridExtra)
here::i_am("project.Rproj")
```

# Data management project :

Joaquim Bamba & Amandine Godefroy

# A - Presentation of the research question

The Kuznets curve, originating from Simon Kuznets' research on economic growth during the 1950s, illustrates a U-shaped correlation between a nation's developmental stage and income inequality. In 1991, Grossman and Krueger expanded this concept to environmental considerations. However, it wasn't until Panayotou's 1993 article that the Environmental Kuznets Curve (EKC) was formally introduced.

The EKC proposes that in the early phases of economic progress, there is minimal concern for environmental issues. As income levels rise sufficiently to meet essential needs, a pivotal threshold (known as the turning point) is reached, prompting heightened environmental awareness and a reversal in trends. Beyond this threshold, economic advancement aligns with enhanced environmental conditions, specifically a decline in pollution. Thus, it suggests an inverse U-shaped association between pollution and economic development.

We will try to see if a country CO2 emission are effectively explained by its economic and industrial development.

# B - Data sets description

## 1. Treatments of the data sets

We first have created two main data sets for our variables depending of there sources. Thus, we have one data sets focused on the variables from the World Bank Open Data that illustrate the economic growth and one data set with variables from the JRC Data Catalog of the European Commission that illustrate the CO2 emissions.

```{r}
#| echo: false
#| warning: false

### Data importation

GDP <- read.csv2(here("data/GDP.csv"))

gdp_per_capita <- read.csv2("data/GDP_per_capita.csv")

gdp_growth <- read.csv2(here("data/GDP_growth.csv"))

energy_consumption <- vroom::vroom(here("data/Energy_consumption.csv"),show_col_types = FALSE)

gross_capital <- read.csv2(here("data/Gross_capital_formation.csv"))

population_growth <- read.csv2(here("data/POP_growth.csv"))

urban_population <- read.csv2(here("data/Urban_population.csv"))

co2<- vroom::vroom(here("data/CO2.csv"), show_col_types = FALSE)

fossil_CO2_by_sector_and_country <- vroom::vroom(here("data/CO2/fossil_CO2_by_sector_and_country.csv"),delim = ";", show_col_types = FALSE)

fossil_CO2_per_GDP_by_country <- vroom::vroom(here("data/CO2/fossil_CO2_per_GDP_by_country.csv"), delim = ";",show_col_types = FALSE)

C02_macro_regions <- vroom::vroom(here("data/CO2/LULUCF by macro regions.csv"),delim = ";", show_col_types = FALSE)

fossil_CO2_totals_by_country <- vroom::vroom(here("data/CO2/fossil_CO2_totals_by_country.csv"),delim = ";", show_col_types = FALSE)

coal_revenu <- vroom::vroom(here("data/coal_revenu.csv"),show_col_types = FALSE)

industrial_production_growth <- vroom::vroom(here("data/industrial_production_growth.csv"), show_col_types = FALSE)

renewable_energy_consumption <- vroom::vroom(here("data/Renewable_energy_consumption.csv"), show_col_types = FALSE)
```

### a. Creation of the economic growth database

#### Variables description

Gross capital formation (in percentage of GDP) : consists of outlays on additions to the fixed assets of the economy plus net changes in the level of inventories.

Annual percentage growth rate of GDP : at market prices based on constant local currency. Aggregates are based on constant 2015 prices, expressed in U.S. dollars.

GDP at purchaser's prices (current US\$) : the sum of gross value added by all resident producers in the economy plus any product taxes and minus any subsidies not included in the value of the products.

Gdp per capita : the gdp (in current US\$) divided by midyear population.

Annual population growth rate for year t : the exponential rate of growth of midyear population from year t-1 to t, expressed as a percentage .

Urban population (in percentage of the total population) : refers to people living in urban areas as defined by national statistical offices.

Renewable energy consumption : Renewable energy consumption is the share of renewable energy in total final energy consumption. We expect this percentage to be higher in developed countries.

```{r}
#### Cleaning of the data sets

##### cleaning of gross_capital

# We erase the unnecessary columns
gross_capital <- gross_capital |>  select(-Indicator.Name, -Indicator.Code, -Country.Code)

#because all the years start with an 'X' we must suppress the 'X' at the start

# we create a variable with all the columns that starts with an "X"
colonnes_a_modifier <- colnames(gross_capital)[startsWith(colnames(gross_capital), "X")]

# We suppress all the "X"
colnames(gross_capital)[startsWith(colnames(gross_capital), "X")] <- sub("^X", "", colonnes_a_modifier)

gross_capital <- gross_capital %>% pivot_longer(cols = c("1960","1961","1962", "1963", "1964", "1965", "1966", "1967", "1968", "1969", "1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"), names_to = "year", values_to = "gross_capital")

# We rename the first column
gross_capital <- gross_capital %>%
  rename(country = Country.Name)

# We put NA instead of blanks
gross_capital <- gross_capital %>% mutate_all(~na_if(., ""))

# We put points instead of commas
gross_capital$gross_capital <- gsub(",", ".", gross_capital$gross_capital, fixed = TRUE)

# We specify that the data are numeric
gross_capital$gross_capital<-as.numeric(gross_capital$gross_capital)

# Then we re-iterate the process for each variable.
```

```{r}
##### cleaning of gdp_growth

gdp_growth <- gdp_growth |>  select(-Indicator.Name, -Indicator.Code, -Country.Code)

colonnes_a_modifier <- colnames(gdp_growth)[startsWith(colnames(gdp_growth), "X")]

colnames(gdp_growth)[startsWith(colnames(gdp_growth), "X")] <- sub("^X", "", colonnes_a_modifier)

gdp_growth <- gdp_growth %>% pivot_longer(cols = c("1960","1961","1962", "1963", "1964", "1965", "1966", "1967", "1968", "1969", "1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"), names_to = "year", values_to = "gdp_growth")

gdp_growth <- gdp_growth %>%
  rename(country = Country.Name)

gdp_growth[gdp_growth == ''] <- NA

gdp_growth$gdp_growth <- gsub(",", ".", gdp_growth$gdp_growth, fixed = TRUE)

gdp_growth$gdp_growth<-as.numeric(gdp_growth$gdp_growth)
```

```{r}
##### cleaning of GDP

GDP <- GDP |>  select(-Indicator.Name, -Indicator.Code, -Country.Code)

colonnes_a_modifier <- colnames(GDP)[startsWith(colnames(GDP), "X")]

colnames(GDP)[startsWith(colnames(GDP), "X")] <- sub("^X", "", colonnes_a_modifier)

GDP <- GDP %>% pivot_longer(cols = c("1960","1961","1962", "1963", "1964", "1965", "1966", "1967", "1968", "1969", "1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"), names_to = "year", values_to = "GDP")

GDP <- GDP %>%
  rename(country = Country.Name)

GDP <- GDP %>% mutate_all(~na_if(., ""))

GDP$GDP <- gsub(",", ".", GDP$GDP, fixed = TRUE)

GDP$GDP<-as.numeric(GDP$GDP)

```

```{r}
##### cleaning of gdp_per_capita

gdp_per_capita <- gdp_per_capita |>  select(-Indicator.Name, -Indicator.Code, -Country.Code)

colonnes_a_modifier <- colnames(gdp_per_capita)[startsWith(colnames(gdp_per_capita), "X")]

colnames(gdp_per_capita)[startsWith(colnames(gdp_per_capita), "X")] <- sub("^X", "", colonnes_a_modifier)

gdp_per_capita <- gdp_per_capita %>% pivot_longer(-Country.Name, names_to = "year", values_to = "gdp_per_capita")

gdp_per_capita <- gdp_per_capita %>%
  rename(country = Country.Name)

gdp_per_capita <- gdp_per_capita %>% mutate_all(~na_if(., ""))

gdp_per_capita$gdp_per_capita <- gsub(",", ".", gdp_per_capita$gdp_per_capita, fixed = TRUE)

gdp_per_capita$gdp_per_capita<-as.numeric(gdp_per_capita$gdp_per_capita)

```

```{r}
##### cleaning of population_growth

population_growth <- population_growth |>  select(-Indicator.Name, -Indicator.Code, -Country.Code)

colonnes_a_modifier <- colnames(population_growth)[startsWith(colnames(population_growth), "X")]

colnames(population_growth)[startsWith(colnames(population_growth), "X")] <- sub("^X", "", colonnes_a_modifier)

population_growth <- population_growth %>% pivot_longer(cols = c("1960","1961","1962", "1963", "1964", "1965", "1966", "1967", "1968", "1969", "1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"), names_to = "year", values_to = "population_growth")

population_growth <- population_growth %>%
  rename(country = Country.Name)

population_growth[population_growth == ''] <- NA

population_growth$population_growth <- gsub(",", ".", population_growth$population_growth, fixed = TRUE)

population_growth$population_growth<-as.numeric(population_growth$population_growth)

```

```{r}
##### cleaning of urban_population

urban_population <- urban_population |>  select(-Indicator.Name, -Indicator.Code, -Country.Code)

colonnes_a_modifier <- colnames(urban_population)[startsWith(colnames(urban_population), "X")]

colnames(urban_population)[startsWith(colnames(urban_population), "X")] <- sub("^X", "", colonnes_a_modifier)

urban_population <- urban_population %>% pivot_longer(cols = c("1960","1961","1962", "1963", "1964", "1965", "1966", "1967", "1968", "1969", "1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"), names_to = "year", values_to = "urban_population")

urban_population <- urban_population %>%
  rename(country = Country.Name)

urban_population <- urban_population %>% mutate_all(~na_if(., ""))

urban_population$urban_population <- gsub(",", ".", urban_population$urban_population, fixed = TRUE)

urban_population$urban_population<-as.numeric(urban_population$urban_population)
```

```{r}
##### cleaning of renewable_energy_consumption

renewable_energy_consumption <- renewable_energy_consumption |>  select(-"Indicator Name", -"Indicator Code", -"Country Code")

renewable_energy_consumption <- renewable_energy_consumption %>% pivot_longer(cols = c("1960","1961","1962", "1963", "1964", "1965", "1966", "1967", "1968", "1969", "1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"), names_to = "year", values_to = "renewable_energy_consumption")

renewable_energy_consumption <- renewable_energy_consumption %>%
  rename(country = "Country Name")

renewable_energy_consumption$renewable_energy_consumption <- gsub(",", ".", renewable_energy_consumption$renewable_energy_consumption, fixed = TRUE)

renewable_energy_consumption$renewable_energy_consumption<-as.numeric(renewable_energy_consumption$renewable_energy_consumption)
```

```{r}
#### Data joining

# We need to create a data base with all the economic growth relative variables.
# In order to do so we join each of the data base two by two
gdp_gdp_growth <- inner_join(GDP, gdp_growth, by=c("country","year"))

all_gdp <- left_join(gdp_gdp_growth, gdp_per_capita, by=c("year","country"))

all_gdp_gross_capital <- inner_join(all_gdp, gross_capital, by=c("country","year"))

pop_growth_urban_pop <- inner_join(population_growth, urban_population, by=c("country","year"))

pop_renewable_energy <- inner_join(pop_growth_urban_pop, renewable_energy_consumption, by=c("country","year"))

# Final economic growth data base
economic_growth_dataset <- inner_join(all_gdp_gross_capital, pop_renewable_energy, by=c("country","year"))
```

#### Basics informations on the economic growth data set

```{r}
table_economic_growth <- economic_growth_dataset |>
  summarise(
    "Number of observations" = nrow(economic_growth_dataset),
    "Number of variables" = ncol(economic_growth_dataset),
    "Number of countries" = economic_growth_dataset |> select(country) |> distinct() |> nrow(), "Number of years" = economic_growth_dataset |> select(year) |> distinct() |> nrow(), ,
    "Mean_GDP" = mean((GDP), na.rm = TRUE),
    "Median_GDP" = median(GDP, na.rm = TRUE),
    "Min_GDP" = min(GDP, na.rm = TRUE),
    "Max_GDP" = max(GDP, na.rm = TRUE)
  )
knitr::kable(table_economic_growth)
```

### b. Creation of the CO2 database

#### Variables description

CO2 by country : Emission country totals of C02 expressed in kt substance

CO2 per GDP by country :

CO2 by sector and country :

```{r}
#### Cleaning of the data sets

##### cleaning of fossil_CO2_totals_by_country

#We get ride of the useless columns
fossil_CO2_totals_by_country <-fossil_CO2_totals_by_country[,c(-1,-2)]

fossil_CO2_totals_by_country <- fossil_CO2_totals_by_country %>% pivot_longer(cols = c("1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021"), names_to = "year", values_to = "CO2_by_country")

fossil_CO2_totals_by_country <- fossil_CO2_totals_by_country %>%
  rename(country = Country)

# We have to put points instead of commas
fossil_CO2_totals_by_country$CO2_by_country <- gsub(",", ".", fossil_CO2_totals_by_country$CO2_by_country, fixed = TRUE)

fossil_CO2_totals_by_country$CO2_by_country<-as.numeric(fossil_CO2_totals_by_country$CO2_by_country)
```

```{r}
##### cleaning of fossil_CO2_per_GDP_by_country

#We get ride of the useless columns
fossil_CO2_per_GDP_by_country <-fossil_CO2_per_GDP_by_country[,c(-1,-2)]

fossil_CO2_per_GDP_by_country <- fossil_CO2_per_GDP_by_country %>% pivot_longer(cols = c("1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021"), names_to = "year", values_to = "CO2_per_GDP_by_country")

fossil_CO2_per_GDP_by_country <- fossil_CO2_per_GDP_by_country %>%
  rename(country = Country)

fossil_CO2_per_GDP_by_country$CO2_per_GDP_by_country <- gsub(",", ".", fossil_CO2_per_GDP_by_country$CO2_per_GDP_by_country, fixed = TRUE)

fossil_CO2_per_GDP_by_country$CO2_per_GDP_by_country<-as.numeric(fossil_CO2_per_GDP_by_country$CO2_per_GDP_by_country)

```

```{r}
##### cleaning of fossil_CO2_by_sector_and_country

#We get ride of the useless columns
fossil_CO2_by_sector_and_country <-fossil_CO2_by_sector_and_country[,c(-1,-2)]

fossil_CO2_by_sector_and_country <- fossil_CO2_by_sector_and_country %>% pivot_longer(cols = c("1970", "1971", "1972", "1973", "1974", "1975", "1976", "1977", "1978", "1979", "1980", "1981", "1982", "1983", "1984", "1985", "1986", "1987", "1988", "1989", "1990", "1991", "1992", "1993", "1994", "1995", "1996", "1997", "1998", "1999", "2000", "2001", "2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021"), names_to = "year", values_to = "CO2_by_sector_country")

fossil_CO2_by_sector_and_country <- fossil_CO2_by_sector_and_country %>%
  rename(country = Country)

fossil_CO2_by_sector_and_country$CO2_by_sector_country <- gsub(",", ".", fossil_CO2_by_sector_and_country$CO2_by_sector_country, fixed = TRUE)

fossil_CO2_by_sector_and_country$CO2_by_sector_country<-as.numeric(fossil_CO2_by_sector_and_country$CO2_by_sector_country)
```

```{r}
#### Data joining

# We join each of the data sets two by two to get our energy data base
CO2_totals_GDP <- inner_join(fossil_CO2_totals_by_country, fossil_CO2_per_GDP_by_country, by=c("country","year"))

CO2_dataset <- inner_join(CO2_totals_GDP, fossil_CO2_by_sector_and_country, by=c("country","year"))
```

#### Basics informations on the CO2 data set

```{r}
table_CO2 <- CO2_dataset |>
  summarise(
    "Number of observations" = nrow(CO2_dataset),
    "Number of variables" = ncol(CO2_dataset),
    "Number of countries" = CO2_dataset |> select(country) |> distinct() |> nrow(), "Number of years" = CO2_dataset |> select(year) |> distinct() |> nrow(), ,
    "Mean_CO2_by_country" = mean(CO2_by_country, na.rm = TRUE),
    "Median_CO2_by_country" = median(CO2_by_country, na.rm = TRUE),
    "Min_CO2_by_country" = min(CO2_by_country, na.rm = TRUE),
    "Max_CO2_by_country" = max(CO2_by_country, na.rm = TRUE)
  )
knitr::kable(table_CO2)
```

### c. Final Data set

To get our final data set for our analysis we merge our two sub-data sets, economic_growth_dataset and CO2_dataset.

```{r}
growth_CO2 <- inner_join(CO2_dataset, economic_growth_dataset, by=c("country","year"))
```

We have in our final data set `r nrow(growth_CO2)` observation and `r ncol(growth_CO2)` variables. Our sample consists of data of `r growth_CO2 |> select(country) |> distinct() |> nrow()` countries over `r CO2_dataset |> select(year) |> distinct() |> nrow()` years.

## 2. Creation of a specific database for the year 2019 only

We found interesting data sets from the CIA's "World Factbook" on CO2's emission by countries. However this dataset only have values for the year 2019. To study those variables we will create a specific database for the year 2019 only, merging first the data sets from the CIA together and then creating a data base with this dataset and the economic_growth dataset restricted for the year 2019 merged together.

#### Variables description

CO2 emissions : Carbon dioxide emissions from consumption of energy is the total amount of carbon dioxide, measured in metric tons, released by burning fossil fuels in the process of producing and consuming energy. This is usually the main variable used to measure how polluting a country is. We will use four different datasets showing the CO2 emissions by sector and country, per capita per country, totals per country, and totals by macro regions.

Energy consumption per capita : measures the total amount of consumed energy divided by a country's population, reported in Btu per person. Linking energy consumption per capita to pollution is vital as higher consumption often translates to increased emissions from energy sources like fossil fuels, contributing significantly to air and greenhouse gas pollution.

Coal revenu : revenu from coal extraction and use as % of the GDP. Coal has a significant environmental impact as a high emitter of pollutants like sulfur dioxide and carbon dioxide when burned for energy.

Industrial_production_growth : annual percentage increase in industrial production (includes manufacturing, mining, and construction). The expansion of industrial activities often leads to increased emissions of pollutants, including greenhouse gases and particulate matter, directly impacting air, water, and soil quality.

```{r}
### Cleaning the data sets

# We keep only the relevant columns
co2 <- select(co2, value, name)

energy_consumption <- select(energy_consumption, value, name)

coal_revenu <- select(coal_revenu, value, name)

industrial_production_growth <- select(industrial_production_growth, value, name)

# We rename them
colnames(co2) <- c("co2.emissions", "country")
colnames(energy_consumption) <- c("energy.consumption", "country")
colnames(coal_revenu) <- c("coal.revenu", "country")
colnames(industrial_production_growth) <- c("industrial.production.growth", "country")
```

```{r}
### data joining

# we merge the data sets by country name
temp_merged <- merge(co2, energy_consumption, by = "country", all = FALSE)
temp_merged <- merge(temp_merged, industrial_production_growth, by = "country", all = FALSE)
# we merge the temporary data set obtained with the last one with name again
energy_dataset2019 <- merge(temp_merged, coal_revenu, by = "country", all = FALSE)
```

We created a dataset containing the information concerning the year 2019. We will use it order to have an overview of the situation using relatively recent data given in instantaneous section.

#### Basics informations on the energy_dataset2019

```{r}
table_energy2019 <- energy_dataset2019 |>
  summarise(
    "Number of observations" = nrow(energy_dataset2019),
    "Number of variables" = ncol(energy_dataset2019),
    "Number of countries" = energy_dataset2019 |> select(country) |> distinct() |> nrow(), 
    "Number of years" = CO2_dataset |> select(year) |> distinct() |> nrow(),
    "Mean_CO2_by_country" = mean(co2.emissions, na.rm = TRUE),
    "Median_CO2_by_country" = median(co2.emissions, na.rm = TRUE),
    "Min_CO2_by_country" = min(co2.emissions, na.rm = TRUE),
    "Max_CO2_by_country" = max(co2.emissions, na.rm = TRUE)
  )
knitr::kable(table_energy2019)
```

```{r}
# We merge our economic_growth_dataset restricted for 2019 only and our energy_dataset2019 
growth_CO2_2019 <- filter(growth_CO2, year==2019)

growth_energy_2019 <- inner_join(growth_CO2_2019, energy_dataset2019, by=join_by(country))
```

We have in our specific 2019 data set (energy_dataset2019) `r nrow(growth_energy_2019)` observation and `r ncol(growth_energy_2019)` variables. Our sample consists of data of `r growth_energy_2019 |> select(country) |> distinct() |> nrow()` countries over `r growth_energy_2019 |> select(year) |> distinct() |> nrow()` years.

# C - Data analysis

## 1. Graphical representations

### a. Most polluting countries in 2019

To have an overview of the countries and their level of pollution, we will make a graphical representation of our target variable : CO2 emissions for the year 2019. We base our analysis on our dataset growth_energy_2019.

```{r}
# Third countries with the highest CO2 emissions ?
top_countries <- growth_energy_2019[order(-growth_energy_2019$co2.emissions), ][1:3, ]

# Creation of the graph with the points of the most polluters
ggplot(data = growth_energy_2019, aes(x = country, y = co2.emissions)) +
  geom_blank() +  # Suppression of the points to mask the name of the other countries on the x axis
  geom_text(data = top_countries, aes(label = country), size = 3, angle = 45, vjust = -0.5, hjust = 1) +  # Display of the names of the greatest polluters
  geom_point(data = top_countries, size = 3) +  # Points for the three greatest polluters
  labs(x = NULL, y = "CO2 emissions in 2019") +  # Suppression of the x axis label 
  ggtitle("Dispersions of CO2 emissions by country in 2019")

```

We can spot that CO2 emissions are very unequally distributed. China, India and the US are by far more polluting.

### b. Top 5 world economies : relation between wealth and CO2 emissions

Now lets plot the CO2 emissions per country depending on their GDP over time. We will study this relation for the top 5 world economies. We will now end for the rest of the analysis use our growth_CO2 base.

```{r}
growth_CO2_50_first<-growth_CO2|>group_by(country)

growth_CO2_50_first<-subset(growth_CO2, country == "United States")

ggplot(growth_CO2_50_first, aes(x = GDP, y = CO2_by_country)) +
  geom_point(na.rm = T) +
  labs(title = "CO2 growth relative to GDP (US 1970-2021)")
```

```{r}
growth_CO2_coutry<-growth_CO2|>select(contains("China"))

growth_CO2_50_first<-subset(growth_CO2, country == "China")

ggplot(growth_CO2_50_first, aes(x = GDP, y = CO2_by_country)) +
  geom_point(na.rm = T) +
  labs(title = "CO2 growth relative to GDP (China 1970-2021)") +
  theme_minimal() +
  theme(
    axis.text.x = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks = element_blank()
  )
```

```{r}
growth_CO2_50_first<-subset(growth_CO2, country == "Japan")

ggplot(growth_CO2_50_first, aes(x = GDP, y = CO2_by_country)) +
  geom_point(na.rm = T) +
  labs(title = "CO2 growth relative to GDP (Japan 1970-2021)") +
  theme_minimal()
```

```{r}
growth_CO2_50_first<-subset(growth_CO2, country == "Germany")

ggplot(growth_CO2_50_first, aes(x = GDP, y = CO2_by_country)) +
  geom_point(na.rm = T) +
  labs(title = "CO2 growth relative to GDP (Germany 1970-2021)") +
  theme_minimal()
```

```{r}
growth_CO2_50_first<-subset(growth_CO2, country == "United Kingdom")

ggplot(growth_CO2_50_first, aes(x = GDP, y = CO2_by_country)) +
  geom_point(na.rm = T) +
  labs(title = "CO2 growth relative to GDP (United Kingdom 1970-2021)") +
  theme_minimal()
```

By plotting the CO2 emissions of the top 5 world economies, we spot that the relation between the two variables is clearly positive in China. Moreover, even if for the US, the reverse U relationship seems to be reflected, we observe mostly a negative relation. In the United Kingdom and in Germany, we observe a negative relation between the CO2 emissions and the GPD over time. However, it is important to mention that the UK and Germany were already considered as developed economies before 1970. It could explain the graphs showing the decreasing part of the reverse U relationship.

### c. Analysis of the relation CO2 emission / GDP per country over time by local regions

#### Western and Eastern European countries

```{r}
western_european_countries <- c("Germany", "Austria", "Belgium", "France", "Ireland", "Luxembourg", "Netherlands", "United Kingdom", "Switzerland", "Liechtenstein", "Monaco","Sweden")

# Filter data for Western European countries
growth_CO2_western_european_countries <- subset(growth_CO2, country %in% western_european_countries)

# Use ggplot with different color for each country
ggplot(growth_CO2_western_european_countries, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Western Europe 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

```

By plotting the Western European countries only, we can clearly spot reverse U relationship for Belgium and the Netherlands however, the data of Sweden, Luxembourg are following the former intuition we had about Germany and the United Kingdom we a purely negative relationship (second part of the reverse U).

To confirm the intuition, let's plot the Eastern Europe countries data considering that they developped later than Eastern ones.

```{r}
eastern_european_countries1 <- c("Estonia", "Hungary", "Kosovo", "Latvia", "Lithuania","Moldova", "Montenegro", "North Macedonia", "Poland", "Romani
")

eastern_european_countries2<- c("Albania", "Belarus", "Bosnia and Herzegovina", "Bulgaria", "Croatia", "Czech Republic")

# Filter data for Western European countries
growth_CO2_eastern_european_countries1 <- subset(growth_CO2, country %in% eastern_european_countries1)

# Using ggplot with different color for each country
plot1<-ggplot(growth_CO2_eastern_european_countries1, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Western Europe 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

growth_CO2_eastern_european_countries2 <- subset(growth_CO2, country %in% eastern_european_countries2)

plot2<-ggplot(growth_CO2_eastern_european_countries2, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Western Europe 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

grid.arrange(plot1, plot2, nrow = 2)

```

Indeed, the expected reverse U relationship is clearer for Eastern European countries than for the Western ones even if we are still able to spot a negative relationship between the variables for the most developed of them such as Poland.

#### Subsaharan African Countries

```{r}
SA_countries1 <- c("Angola", "Benin", "Botswana", "Burkina Faso", "Burundi", "Cabo Verde", "Cameroon", "Central African Republic", "Chad", "Comoros", "Democratic Republic of the Congo")

SA_countries2 <- c("Djibouti", "Equatorial Guinea", "Eritrea", "Eswatini", "Ethiopia", "Gabon", "The Gambia", "Ghana", "Guinea", "Guinea-Bissau", "Ivory Coast", "Kenya", "Lesotho")

SA_countries3 <- c("Liberia", "Madagascar", "Malawi", "Mali", "Mauritania", "Mauritius", "Mozambique", "Namibia", "Niger", "Nigeria", "Republic of the Congo", "Rwanda", "Sao Tome and Principe")

SA_countries4 <- c("Senegal", "Seychelles", "Sierra Leone", "Somalia", "South Africa", "South Sudan", "Sudan", "Tanzania", "Togo", "Uganda", "Zambia", "Zimbabwe")


# Filter data for Subsaharan African countries
growth_CO2_SA_countries1 <- subset(growth_CO2, country %in% SA_countries1)

# Using ggplot with different color for each country
plot1<-ggplot(growth_CO2_SA_countries1, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Sub-Saharan Africa 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

growth_CO2_SA_countries2 <- subset(growth_CO2, country %in% SA_countries2)

plot2<-ggplot(growth_CO2_SA_countries2, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Sub-Saharan Africa 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

growth_CO2_SA_countries3 <- subset(growth_CO2, country %in% SA_countries3)

plot3<-ggplot(growth_CO2_SA_countries3, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Sub-Saharan Africa 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

growth_CO2_SA_countries4 <- subset(growth_CO2, country %in% SA_countries4)

plot4<-ggplot(growth_CO2_SA_countries4, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Sub-Saharan Africa 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())

grid.arrange(plot1, plot2, nrow = 2)
grid.arrange(plot3, plot4, nrow = 2)
```

When we pay attention to the Sub-Saharan African countries that are still developing the relation relation between CO2 emissions and GDP seems to be positive considering that these country are still on the first part of reverse U relationship between these two variables.

South Africa appears as an out-liner since it an emerging economy.

#### Emerging economies

During the COP assemblies, the BRICS are often pointed out as major polluters by developed countries.

They respond by saying that their increasing amount of CO2 emission is a simple consequence of their skyrocketing development and that they will pollute less as soon as they will be as developed as the Western countries.

```{r}
emerging_countries <- c("South Africa", "Russia", "Brazil", "India", "China")

# Filtering data for emerging countries
growth_CO2_emerging_countries <- subset(growth_CO2, country %in% emerging_countries)

# Using ggplot with different color for each country
ggplot(growth_CO2_emerging_countries, aes(x = GDP, y = CO2_by_country, color = country)) +
  geom_point(na.rm = TRUE) +
  labs(title = "CO2 Growth vs GDP (Emerging economies 1970-2021)") +
  theme_minimal()+
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank())
```

When plotting the data concerning the BRICS, we see that the relationship is effectively positive over time.

## 2. Econometric analysis

To confirm the existence of a U shape relation between the CO2 emissions and the wealth we will use the OLS method on our data. In order to do so we will made this analysis on 4 distinct panels of country classed by their degrees of development.

### a. Creation of dataframes depending of the countries level of development

We will class the countries into 4 categories according to the mean of their gdp per capita over the period studied. We will divide the countries according to the quantiles of the distribution of their mean gdp per capita.

```{r}
gdp_per_capita_mean <- growth_CO2 |> group_by(country) |> summarise(mean(gdp_per_capita, na.rm = T))

summary(gdp_per_capita_mean)
```

```{r}
low_income_countries <- growth_CO2 |> group_by(country) |> filter(mean(gdp_per_capita, na.rm = T)<1236)

lower_middle_income_countries <- growth_CO2 |> group_by(country) |> filter(mean(gdp_per_capita, na.rm = T)>= 1236 & mean(gdp_per_capita, na.rm = T)<3772)

upper_middle_income_countries <- growth_CO2 |> group_by(country) |> filter(mean(gdp_per_capita, na.rm = T)>= 3772& mean(gdp_per_capita, na.rm = T)<12936)

high_income_countries <- growth_CO2 |> group_by(country) |> filter(mean(gdp_per_capita, na.rm = T)>=1236)
```

```{r}
#| message: false
#| echo: false
# Handling missing values
## To better calculate our regressions, we remove countries with missing values.

### Low income countries
# We search if there are any NA in our data
# low_income_countries |> summarise(anyNA(CO2_by_country))
#low_income_countries |> summarise(anyNA(GDP))
# We suppress the NA to conduct a better analysis
low_income_countries <- low_income_countries %>%
  group_by(country) %>%
  filter(all(!is.na(GDP)))

### Lower middle income countries
#lower_middle_income_countries |> summarise(anyNA(CO2_by_country))
#lower_middle_income_countries |> summarise(anyNA(GDP))

lower_middle_income_countries <- lower_middle_income_countries %>%
  group_by(country) %>%
  filter(all(!is.na(GDP)))

### Upper middle income countries
#upper_middle_income_countries |> summarise(anyNA(CO2_by_country))
#upper_middle_income_countries |> summarise(anyNA(GDP))

upper_middle_income_countries <- upper_middle_income_countries %>%
  group_by(country) %>%
  filter(all(!is.na(GDP)))

### High income countries
#high_income_countries |> summarise(anyNA(CO2_by_country))
#high_income_countries |> summarise(anyNA(GDP))

high_income_countries <- high_income_countries %>%
  group_by(country) %>%
  filter(all(!is.na(GDP)))
```

```{r}
# For the regression we need the squared gdp, thus we create it and add it to our data frames.

low_income_countries$GDP_carre <- (low_income_countries$GDP)^2
lower_middle_income_countries$GDP_carre <- (lower_middle_income_countries$GDP)^2
upper_middle_income_countries$GDP_carre <- (upper_middle_income_countries$GDP)^2
high_income_countries$GDP_carre <- (high_income_countries$GDP)^2
```

### b. Correlation

Lets look for a correlation between the CO2 emissions of a country and its wealth. In order to do so, we represent the correlation with a graph.

```{r}
#| message: false
ggplot(low_income_countries, aes(x = GDP, y =CO2_by_country)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Correlation between the CO2 emission and the wealth of low income countries ",
       x = "GDP",
       y = "CO2 level of emission") +
  theme_minimal()
```

```{r}
#| message: false
ggplot(high_income_countries, aes(x = CO2_by_country, y = GDP)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Correlation between the CO2 emission and the wealth of high income countries ",
       x = "CO2 level of emission",
       y = "GDP") +
  theme_minimal()
```

```{r}
#| message: false
ggplot(lower_middle_income_countries, aes(x = CO2_by_country, y = GDP)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Correlation between the CO2 emission and the wealth of lower middle income countries ",
       x = "CO2 level of emission",
       y = "GDP") +
  theme_minimal()
```

```{r}
#| message: false
ggplot(upper_middle_income_countries, aes(x = CO2_by_country, y = GDP)) +
  geom_point() +
  geom_smooth(method = "lm", se = FALSE, color = "blue") +
  labs(title = "Correlation between the CO2 emission and the wealth of upper middle income countries ",
       x = "CO2 level of emission",
       y = "GDP") +
  theme_minimal()
```

### c. OLS regressions

We will conduct 4 OLS regressions on the following model :

$$ CO2_i = \beta\_0 + \beta\_1 GDP_i + \beta\_2 GDP^2_i+\varepsilon\_i$$

We regress the CO2 on the GDP and the GDP squared for each country of the group for each year. Having a reverse U relationship means that the coefficient of the GDP and the GDP squared have to be respectively positive and negative.

#### Low income countries

```{r}
# we compute the regression
ols_low_income_countries <- lm( CO2_by_country ~ GDP + GDP_carre, data = low_income_countries)
# we display the results with the p-values
resume_ols_low_income_countries <- summary(ols_low_income_countries)
print(resume_ols_low_income_countries$coefficients)
```

#### Lower middle income countries

```{r}
ols_lower_middle_income_countries <- lm( CO2_by_country ~ GDP + GDP_carre, data = lower_middle_income_countries)
resume_ols_lower_middle_income_countries <- summary(ols_lower_middle_income_countries)
print(resume_ols_lower_middle_income_countries$coefficients)
```

#### Upper middle income countries

```{r}
ols_upper_middle_income_countries <- lm( CO2_by_country ~ GDP + GDP_carre, data = upper_middle_income_countries)
resume_ols_upper_middle_income_countries <- summary(ols_upper_middle_income_countries)
print(resume_ols_upper_middle_income_countries$coefficients)
```

#### High income countries

```{r}
ols_high_income_countries <- lm( CO2_by_country ~ GDP + GDP_carre, data = high_income_countries)
resume_ols_high_income_countries <- summary(ols_high_income_countries)
print(resume_ols_high_income_countries$coefficients)
```

For each model, both variables are significant (their p-value is \<1%). The coefficient of the GDP is positive and the one of the GDP squared is negative. Thus we can validate the existence of an EKC for each group of countries with a turning point highlighted by the significance of the GDP_carre's coefficient.

### d. Khi-2 test

$$ H_0 : \text{CO2 and GDP are independent} $$ $$ H_1 : \text{CO2 and GDP are dependent} $$

#### Low income countries

```{r}
#| warning: false

low_income_chi2 <- chisq.test(low_income_countries[, c("CO2_by_country", "GDP")])

print(low_income_chi2)
```

#### Lower middle income countries

```{r}
#| warning: false

lower_middle_income_chi2 <- chisq.test(lower_middle_income_countries[, c("CO2_by_country", "GDP")])

print(lower_middle_income_chi2)
```

#### Upper middle income countries

```{r}
#| warning: false

upper_middle_income_chi2 <- chisq.test(upper_middle_income_countries[, c("CO2_by_country", "GDP")])

print(upper_middle_income_chi2)
```

#### High income countries

```{r}
#| warning: false

high_income_chi2 <- chisq.test(high_income_countries[, c("CO2_by_country", "GDP")])

print(high_income_chi2)
```

For each group, we can reject H_0 thanks to the p-value and conclude that CO2 emissions and GDP are effectively dependent whatever the country's development stage.

### e. Improving the model

Now, let's take into account additional variables also linked to development : the gross capital allowing higher production capacity, the growth of the population and the share of the urban population in order to find out if they also participate to the increase of CO2 emissions.

$$ CO2_i = \beta\_0 + \beta\_1 GDP_i + \beta\_2 GDP^2_i+\beta\_3 gPOP_i+\beta\_4 POPurban_i+\varepsilon\_i$$\

#### Low income countries

```{r}
# we compute the regression
ols_low_income_countries2 <- lm(CO2_by_country ~ GDP + GDP_carre +gross_capital+ population_growth+urban_population, data = low_income_countries)
# we display the results with the p-values
resume_ols_low_income_countries2 <- summary(ols_low_income_countries2)
print(resume_ols_low_income_countries2$coefficients)
```

#### Lower middle income countries

```{r}
ols_lower_middle_income_countries2 <- lm( CO2_by_country ~ GDP + GDP_carre +gross_capital+ population_growth+urban_population, data = lower_middle_income_countries)
resume_ols_lower_middle_income_countries2 <- summary(ols_lower_middle_income_countries2)
print(resume_ols_lower_middle_income_countries2$coefficients)
```

#### Upper middle income countries

```{r}
ols_upper_middle_income_countries2 <- lm( CO2_by_country ~ GDP + GDP_carre +gross_capital+ population_growth + urban_population, data = upper_middle_income_countries)
resume_ols_upper_middle_income_countries2 <- summary(ols_upper_middle_income_countries2)
print(resume_ols_upper_middle_income_countries2$coefficients)
```

#### High income countries

```{r}
ols_high_income_countries2 <- lm( CO2_by_country ~ GDP + GDP_carre +gross_capital+ population_growth+urban_population, data = high_income_countries)
resume_ols_high_income_countries2 <- summary(ols_high_income_countries2)
print(resume_ols_high_income_countries2$coefficients)
```

#### All countries

```{r}
# first we suppress the NAs for a better estimation of the model
growth_CO2_2 <- growth_CO2 %>%
  group_by(country) %>%
  filter(all(!is.na(GDP)))
# then once again we create a variable for the gdp squared
growth_CO2_2$GDP_carre <- (growth_CO2_2$GDP)^2

# then we do the same regression than above 
ols_all_countries <- lm(CO2_by_country ~ GDP + GDP_carre +gross_capital+ population_growth+urban_population, data = growth_CO2_2)
resume_ols_all_countries <- summary(ols_all_countries)
print(resume_ols_all_countries$coefficients)
```

We spot that without paying attention the development stage of the country the the gross capital and the urban population have a significant impact on the CO2 emissions. Gross capital tends to impact positively CO2 emissions meanwhile the raise of the urban population tends to lower CO2 emissions.

Indeed, gross capital is linked to a raise of the industrial production wich is of course a polluting activity. On the other hand, the raise of the urban population is linked to efficient infrastructures, highest density of living (less vehiculed commutes), promotion of sustainable practices and energy efficiency.

# E - Annex

## Links and sources

[Link github repository](https://github.com/JoaquimBamba/project)

### a. *Sources* *:*

-   **World Bank Open Data :** The World Bank Open Data is an initiative by the World Bank Group that provides free and open access to a wide range of global development data. It offers a vast collection of data on various aspects of development across countries, including social, economic, financial, and environmental indicators. This data is made available to the public, researchers, policymakers, and developers to promote transparency, informed decision-making, and development efforts worldwide. The World Bank Open Data platform allows users to access, download, and visualize data in various formats, including charts, graphs, and maps. It serves as a valuable resource for researchers, policymakers, journalists, and anyone interested in understanding global development trends and making data-driven decisions to support development initiatives worldwide.

-   **European Commission, JRC Data Catalog :** The main website of the European Commission's joint research center. The JRC provides independent and evidence-based science and knowledge supporting the EU policies. We used in our analysis variables from the EDGARv5.0 dataset. EDGAR is a multipurpose, independent, global database of anthropogenic emissions of greenhouse gases and air pollution on Earth. EDGAR provides independent emission estimates compared to what reported by European Member States or by Parties under the United Nations Framework Convention on Climate Change (UNFCCC), using international statistics and a consistent IPCC methodology.

-   **The CIA's "World Factbook" :** The The CIA's "World Factbook" is a comprehensive and publicly available online resource that provides information about countries around the world. Created and maintained by the United States Central Intelligence Agency (CIA), this publication offers a detailed overview of various aspects of nations, including their geography, population, government, economy, infrastructure, history, and much more. The World Factbook is regularly updated to reflect demographic, political, economic, and other changes in countries worldwide. It's used by numerous individuals, including researchers, students, journalists, and professionals, as a reliable reference for obtaining accurate data about countries.

### b. *Links to the sources :*

[All CO2 emission data from the JRC data catalog](https://data.jrc.ec.europa.eu/dataset/377801af-b094-4943-8fdc-f79a7c0c2d19#dataaccess)

[GDP growth](https://data.worldbank.org/indicator/NY.GDP.MKTP.KD.ZG)

[GDP](https://data.worldbank.org/indicator/NY.GDP.MKTP.CD)

[GDP per capita](https://data.worldbank.org/indicator/NY.GDP.PCAP.CD)

[Gross capital formation](https://data.worldbank.org/indicator/NE.GDI.TOTL.ZS?view=chart)

[Population growth](https://data.worldbank.org/indicator/SP.POP.GROW?view=chart)

[Urban population](https://data.worldbank.org/indicator/SP.URB.TOTL.IN.ZS?view=chart)

[Renewable energy consumption](https://data.worldbank.org/indicator/EG.FEC.RNEW.ZS)

[Industrial production growth rate 2019](https://www.cia.gov/the-world-factbook/field/industrial-production-growth-rate/country-comparison/)

[Energy consumption 2019](https://www.cia.gov/the-world-factbook/field/energy-consumption-per-capita/country-comparison/)

[CO2 emission 2019](https://www.cia.gov/the-world-factbook/field/carbon-dioxide-emissions/country-comparison/)

[Coal revenu 2019](https://www.cia.gov/the-world-factbook/field/revenue-from-coal/country-comparison/)
